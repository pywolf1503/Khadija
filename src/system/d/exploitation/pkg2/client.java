package system.d.exploitation.pkg2;

import system.d.exploitation.pkg2.util.SemaphoreManager;


/**
 * La classe {@code client} représente un client dans le système de production.
 * Elle implémente l'interface {@code Runnable} pour pouvoir être utilisée comme un thread.
 */
public class client implements Runnable {

    /** L'entrepôt associé à ce client. */
    private entrepot ent;

    /**
     * Obtient l'entrepôt associé à ce client.
     *
     * @return L'entrepôt associé à ce client.
     */
    public entrepot getEnt() {
        return ent;
    }

    /**
     * Définit l'entrepôt associé à ce client.
     *
     * @param ent L'entrepôt à associer à ce client.
     */
    public void setEnt(entrepot ent) {
        this.ent = ent;
    }

    /**
     * Exécute cette opération.
     */
    @Override
    public void run() {
        while (true) {
            try {
                SemaphoreManager.full.p(1);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            try {
                SemaphoreManager.mutex.p(1);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            ent.retirerStock();
            SemaphoreManager.mutex.v(1);
            SemaphoreManager.empty.v(1);
        }
    }
}
